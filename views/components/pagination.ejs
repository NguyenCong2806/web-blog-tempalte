<% 
  // 1. Chỉ hiển thị nếu có biến pagination và tổng số trang > 1
  if (typeof pagination !== 'undefined' && pagination.totalPages > 1) { 
%>

<div class="flex flex-col items-center mt-12 sm:mt-16 md:mt-20 space-y-4 sm:space-y-6 font-sans select-none">
  
  <div class="flex justify-center items-center gap-1 sm:gap-2 flex-wrap">
  
    <% 
      // 2. Hàm tạo URL chuẩn (Toàn bộ key viết thường)
      const createUrl = (page) => {
          // Bắt đầu với pageindex
          let url = `?pageindex=${page}`;
          
          // Nối thêm pagesize nếu có
          if(pagination.pageSize) {
            url += `&pagesize=${pagination.pageSize}`;
          }
          
          // Nối thêm keyword nếu có (để không bị mất tìm kiếm)
          if(pagination.keyword) {
            url += `&keyword=${pagination.keyword}`;
          }
          
          return url;
      }
      
      const current = pagination.currentPage;
      const total = pagination.totalPages;
    %>

    <a href="<%= current > 1 ? createUrl(current - 1) : '#' %>" 
       class="flex items-center justify-center px-3 sm:px-4 py-2.5 sm:py-3 rounded-xl border-2 transition-all duration-300 font-semibold text-sm sm:text-base
              <%= current === 1 
                  ? 'bg-gray-100 border-gray-200 text-gray-400 cursor-not-allowed pointer-events-none' 
                  : 'bg-white border-teal-300 text-teal-600 hover:bg-teal-50 hover:text-teal-700 hover:border-teal-500 shadow-sm hover:shadow-md group' %>"
       title="Trang trước">
       <i class="fa-solid fa-chevron-left text-xs group-hover:-translate-x-1 transition-transform"></i>
       <span class="hidden sm:inline ml-1.5 font-bold">Trước</span>
    </a>

    <% 
       // Tính toán khoảng hiển thị (Ví dụ: đang ở 5 thì hiện 3 4 [5] 6 7)
       let startPage = Math.max(1, current - 2);
       let endPage = Math.min(total, current + 2);

       // Luôn hiển thị trang 1 nếu khoảng hiển thị bị đẩy đi quá xa
       if (startPage > 1) { %>
          <a href="<%= createUrl(1) %>" 
             class="hidden sm:flex items-center justify-center w-10 h-10 rounded-xl border-2 border-teal-200 bg-white text-teal-600 hover:bg-teal-50 hover:text-teal-700 text-sm font-bold transition-all duration-300 hover:shadow-md group">
             <span class="group-hover:scale-110 transition-transform">1</span>
          </a>
          <% if (startPage > 2) { %>
            <span class="hidden sm:inline text-gray-400 px-1 font-bold">…</span>
          <% } %>
    <% } %>

    <% for(let i = startPage; i <= endPage; i++) { %>
      <a href="<%= createUrl(i) %>" 
         class="flex items-center justify-center w-10 h-10 rounded-xl border-2 text-sm font-bold transition-all duration-300 shadow-sm hover:shadow-md
                <%= i === current 
                    ? 'bg-gradient-to-br from-teal-600 to-teal-700 border-teal-700 text-white shadow-teal-200 scale-110' 
                    : 'bg-white border-teal-200 text-teal-600 hover:bg-teal-50 hover:text-teal-700 hover:border-teal-500 hover:scale-105' %>">
        <span class="group-hover:scale-110 transition-transform"><%= i %></span>
      </a>
    <% } %>

    <% if (endPage < total) { %>
          <% if (endPage < total - 1) { %>
            <span class="hidden sm:inline text-gray-400 px-1 font-bold">…</span>
          <% } %>
          <a href="<%= createUrl(total) %>" 
             class="hidden sm:flex items-center justify-center w-10 h-10 rounded-xl border-2 border-teal-200 bg-white text-teal-600 hover:bg-teal-50 hover:text-teal-700 text-sm font-bold transition-all duration-300 hover:shadow-md group">
             <span class="group-hover:scale-110 transition-transform"><%= total %></span>
          </a>
    <% } %>

    <a href="<%= current < total ? createUrl(current + 1) : '#' %>" 
       class="flex items-center justify-center px-3 sm:px-4 py-2.5 sm:py-3 rounded-xl border-2 transition-all duration-300 font-semibold text-sm sm:text-base
              <%= current === total 
                  ? 'bg-gray-100 border-gray-200 text-gray-400 cursor-not-allowed pointer-events-none' 
                  : 'bg-white border-teal-300 text-teal-600 hover:bg-teal-50 hover:text-teal-700 hover:border-teal-500 shadow-sm hover:shadow-md group' %>"
       title="Trang sau">
       <span class="hidden sm:inline mr-1.5 font-bold">Sau</span>
       <i class="fa-solid fa-chevron-right text-xs group-hover:translate-x-1 transition-transform"></i>
    </a>

  </div>

  <div class="text-xs sm:text-sm text-gray-600 font-semibold bg-gradient-to-r from-teal-50 to-blue-50 px-4 sm:px-6 py-2.5 sm:py-3 rounded-xl border border-teal-200">
      Trang <span class="text-teal-700 font-bold"><%= current %></span> / <span class="text-teal-700 font-bold"><%= total %></span>
  </div>

</div>
<% } %>