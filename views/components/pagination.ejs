<% 
  // 1. Chỉ hiển thị nếu có biến pagination và tổng số trang > 1
  if (typeof pagination !== 'undefined' && pagination.totalPages > 1) { 
%>

<div class="flex flex-col items-center mt-8 space-y-3 font-sans select-none">
  
  <div class="flex justify-center items-center gap-2">
  
    <% 
      // 2. Hàm tạo URL chuẩn (Toàn bộ key viết thường)
      const createUrl = (page) => {
          // Bắt đầu với pageindex
          let url = `?pageindex=${page}`;
          
          // Nối thêm pagesize nếu có
          if(pagination.pageSize) {
            url += `&pagesize=${pagination.pageSize}`;
          }
          
          // Nối thêm keyword nếu có (để không bị mất tìm kiếm)
          if(pagination.keyword) {
            url += `&keyword=${pagination.keyword}`;
          }
          
          return url;
      }
      
      const current = pagination.currentPage;
      const total = pagination.totalPages;
    %>

    <a href="<%= current > 1 ? createUrl(current - 1) : '#' %>" 
       class="flex items-center justify-center px-3 py-2 rounded-lg border transition-all duration-200
              <%= current === 1 
                  ? 'bg-gray-100 border-gray-200 text-gray-400 cursor-not-allowed pointer-events-none' 
                  : 'bg-white border-gray-300 text-gray-600 hover:bg-blue-50 hover:text-blue-600 hover:border-blue-300 shadow-sm' %>"
       title="Trang trước">
       <i class="fa-solid fa-chevron-left text-xs sm:mr-1"></i>
       <span class="hidden sm:inline text-sm font-medium">Trước</span>
    </a>

    <% 
       // Tính toán khoảng hiển thị (Ví dụ: đang ở 5 thì hiện 3 4 [5] 6 7)
       let startPage = Math.max(1, current - 2);
       let endPage = Math.min(total, current + 2);

       // Luôn hiển thị trang 1 nếu khoảng hiển thị bị đẩy đi quá xa
       if (startPage > 1) { %>
          <a href="<%= createUrl(1) %>" 
             class="hidden sm:flex items-center justify-center w-9 h-9 rounded-lg border border-gray-300 bg-white text-gray-600 hover:bg-blue-50 hover:text-blue-600 text-sm font-medium transition-colors">
             1
          </a>
          <% if (startPage > 2) { %>
            <span class="hidden sm:inline text-gray-400 px-1">...</span>
          <% } %>
    <% } %>

    <% for(let i = startPage; i <= endPage; i++) { %>
      <a href="<%= createUrl(i) %>" 
         class="flex items-center justify-center w-9 h-9 rounded-lg border text-sm font-medium transition-all duration-200 shadow-sm
                <%= i === current 
                    ? 'bg-blue-600 border-blue-600 text-white shadow-blue-200' 
                    : 'bg-white border-gray-300 text-gray-600 hover:bg-blue-50 hover:text-blue-600 hover:border-blue-300' %>">
        <%= i %>
      </a>
    <% } %>

    <% if (endPage < total) { %>
          <% if (endPage < total - 1) { %>
            <span class="hidden sm:inline text-gray-400 px-1">...</span>
          <% } %>
          <a href="<%= createUrl(total) %>" 
             class="hidden sm:flex items-center justify-center w-9 h-9 rounded-lg border border-gray-300 bg-white text-gray-600 hover:bg-blue-50 hover:text-blue-600 text-sm font-medium transition-colors">
             <%= total %>
          </a>
    <% } %>

    <a href="<%= current < total ? createUrl(current + 1) : '#' %>" 
       class="flex items-center justify-center px-3 py-2 rounded-lg border transition-all duration-200
              <%= current === total 
                  ? 'bg-gray-100 border-gray-200 text-gray-400 cursor-not-allowed pointer-events-none' 
                  : 'bg-white border-gray-300 text-gray-600 hover:bg-blue-50 hover:text-blue-600 hover:border-blue-300 shadow-sm' %>"
       title="Trang sau">
       <span class="hidden sm:inline text-sm font-medium">Sau</span>
       <i class="fa-solid fa-chevron-right text-xs sm:ml-1"></i>
    </a>

  </div>

  <div class="text-xs text-gray-500 font-medium">
      Trang <span class="text-gray-900"><%= current %></span> / <span class="text-gray-900"><%= total %></span>
  </div>

</div>
<% } %>